# 기능 명세서

## 1. 인증 기능

### 1.1 회원가입
| 항목 | 내용 |
|------|------|
| 기능 ID | AUTH-001 |
| 설명 | 새로운 사용자 계정 생성 |
| 입력 | 이메일, 비밀번호, 이름, 전화번호, 역할(master/client) |
| 처리 | Supabase Auth로 계정 생성 → profiles 테이블에 프로필 생성 |
| 출력 | 성공 시 자동 로그인, 실패 시 에러 메시지 |
| 유효성검사 | 이메일 형식, 비밀번호 8자 이상, 전화번호 형식 |

### 1.2 로그인
| 항목 | 내용 |
|------|------|
| 기능 ID | AUTH-002 |
| 설명 | 기존 계정으로 로그인 |
| 입력 | 이메일, 비밀번호 |
| 처리 | Supabase Auth 인증 → 역할 확인 → 해당 화면으로 이동 |
| 출력 | 성공 시 메인 화면, 실패 시 에러 메시지 |

### 1.3 로그아웃
| 항목 | 내용 |
|------|------|
| 기능 ID | AUTH-003 |
| 설명 | 현재 세션 종료 |
| 처리 | Supabase Auth 세션 삭제 → 로그인 화면 이동 |

### 1.4 비밀번호 재설정
| 항목 | 내용 |
|------|------|
| 기능 ID | AUTH-004 |
| 설명 | 이메일로 비밀번호 재설정 링크 전송 |
| 입력 | 이메일 |
| 처리 | Supabase Auth 비밀번호 재설정 이메일 발송 |

---

## 2. 프로필 관리

### 2.1 프로필 조회
| 항목 | 내용 |
|------|------|
| 기능 ID | PROFILE-001 |
| 설명 | 본인 프로필 정보 조회 |
| 출력 | 이름, 전화번호, 프로필 사진, 역할, 기술(마스터), 자기소개 |

### 2.2 프로필 수정
| 항목 | 내용 |
|------|------|
| 기능 ID | PROFILE-002 |
| 설명 | 프로필 정보 업데이트 |
| 입력 | 이름, 전화번호, 프로필 사진, 기술, 자기소개 |
| 처리 | 사진 업로드 시 Storage에 저장 → profiles 테이블 업데이트 |

### 2.3 프로필 사진 업로드
| 항목 | 내용 |
|------|------|
| 기능 ID | PROFILE-003 |
| 설명 | 프로필 이미지 업로드/변경 |
| 처리 | 이미지 리사이징 → Storage avatars 버킷에 저장 → URL 반환 |
| 제한 | 최대 5MB, JPG/PNG 형식 |

---

## 3. 프로젝트 관리 (관리자)

### 3.1 대형 프로젝트 생성
| 항목 | 내용 |
|------|------|
| 기능 ID | PROJECT-001 |
| 설명 | 새로운 대형 프로젝트 생성 |
| 권한 | super_admin, project_manager |
| 입력 | 제목, 설명, 클라이언트, 위치, 예정일 |
| 처리 | major_projects 테이블에 삽입 |
| 출력 | 생성된 프로젝트 ID |

### 3.2 소형 프로젝트 생성
| 항목 | 내용 |
|------|------|
| 기능 ID | PROJECT-002 |
| 설명 | 대형 프로젝트 내 소형 프로젝트 생성 |
| 권한 | super_admin, project_manager |
| 입력 | 대형 프로젝트 ID, 제목, 설명, 필요 인원, 작업 범위 |
| 처리 | minor_projects 테이블에 삽입 |

### 3.3 프로젝트 상태 변경
| 항목 | 내용 |
|------|------|
| 기능 ID | PROJECT-003 |
| 설명 | 프로젝트 상태 업데이트 |
| 권한 | super_admin, project_manager |
| 상태 흐름 | draft → recruiting → in_progress → completed/cancelled |

### 3.4 프로젝트 목록 조회
| 항목 | 내용 |
|------|------|
| 기능 ID | PROJECT-004 |
| 설명 | 프로젝트 목록 조회 (필터/정렬) |
| 필터 | 상태, 날짜 범위, 담당자 |
| 정렬 | 생성일, 예정일, 상태 |

### 3.5 프로젝트 상세 조회
| 항목 | 내용 |
|------|------|
| 기능 ID | PROJECT-005 |
| 설명 | 프로젝트 상세 정보 및 하위 프로젝트 조회 |
| 출력 | 프로젝트 정보, 소형 프로젝트 목록, 참가자, 사진, 채팅 |

---

## 4. 프로젝트 참가 (마스터)

### 4.1 신청 가능 프로젝트 조회
| 항목 | 내용 |
|------|------|
| 기능 ID | PARTICIPATE-001 |
| 설명 | 모집 중인 프로젝트 목록 조회 |
| 권한 | master |
| 필터 | 상태(recruiting), 위치, 날짜 |
| 출력 | 프로젝트 목록, 필요 인원, 현재 신청 인원 |

### 4.2 프로젝트 신청
| 항목 | 내용 |
|------|------|
| 기능 ID | PARTICIPATE-002 |
| 설명 | 소형 프로젝트에 참가 신청 |
| 권한 | master |
| 입력 | 소형 프로젝트 ID, 메모(선택) |
| 처리 | project_participants 테이블에 삽입 (status: applied) |
| 검증 | 중복 신청 방지, 일정 충돌 확인 |

### 4.3 신청 취소
| 항목 | 내용 |
|------|------|
| 기능 ID | PARTICIPATE-003 |
| 설명 | 참가 신청 취소 |
| 권한 | master (본인 신청만) |
| 조건 | 승인 전에만 취소 가능 |
| 처리 | status를 'withdrawn'으로 변경 |

### 4.4 참가 승인/거절 (관리자)
| 항목 | 내용 |
|------|------|
| 기능 ID | PARTICIPATE-004 |
| 설명 | 마스터 참가 신청 승인 또는 거절 |
| 권한 | super_admin, project_manager |
| 처리 | status를 'approved' 또는 'rejected'로 변경 |
| 후처리 | 승인 시 푸시 알림 발송 |

---

## 5. 작업 사진 관리

### 5.1 사진 업로드
| 항목 | 내용 |
|------|------|
| 기능 ID | PHOTO-001 |
| 설명 | 비포/애프터 작업 사진 업로드 |
| 권한 | master (참가 중인 프로젝트만) |
| 입력 | 소형 프로젝트 ID, 사진 타입(before/after), 이미지, 작업 구역, 설명 |
| 처리 | Storage에 이미지 저장 → project_photos 테이블에 삽입 |
| 제한 | 이미지당 최대 10MB, 프로젝트당 최대 50장 |

### 5.2 사진 조회
| 항목 | 내용 |
|------|------|
| 기능 ID | PHOTO-002 |
| 설명 | 프로젝트 사진 조회 |
| 권한 | 프로젝트 참가자, 관리자, 클라이언트(본인 프로젝트) |
| 필터 | 사진 타입, 작업 구역, 업로더 |
| 출력 | 사진 목록 (썸네일), 비포/애프터 쌍으로 그룹화 |

### 5.3 사진 삭제
| 항목 | 내용 |
|------|------|
| 기능 ID | PHOTO-003 |
| 설명 | 업로드한 사진 삭제 |
| 권한 | 업로더 본인, super_admin |
| 조건 | 프로젝트 완료 전에만 삭제 가능 |

---

## 6. 채팅 기능

### 6.1 채팅방 입장
| 항목 | 내용 |
|------|------|
| 기능 ID | CHAT-001 |
| 설명 | 프로젝트 채팅방 입장 |
| 권한 | 해당 프로젝트 참가자, 관리자 |
| 처리 | Supabase Realtime 구독 시작 |

### 6.2 메시지 전송
| 항목 | 내용 |
|------|------|
| 기능 ID | CHAT-002 |
| 설명 | 텍스트/이미지 메시지 전송 |
| 권한 | 프로젝트 참가자 (프로젝트 진행 중에만) |
| 입력 | 메시지 내용 또는 이미지 |
| 처리 | chat_messages 테이블에 삽입 → Realtime으로 전파 |

### 6.3 메시지 조회
| 항목 | 내용 |
|------|------|
| 기능 ID | CHAT-003 |
| 설명 | 채팅 메시지 히스토리 조회 |
| 처리 | 페이지네이션으로 과거 메시지 로드 (20개씩) |

### 6.4 채팅 이미지 전송
| 항목 | 내용 |
|------|------|
| 기능 ID | CHAT-004 |
| 설명 | 채팅에서 이미지 공유 |
| 처리 | Storage chat-images 버킷에 저장 → 메시지에 URL 포함 |
| 제한 | 최대 5MB |

### 6.5 완료 프로젝트 채팅 열람
| 항목 | 내용 |
|------|------|
| 기능 ID | CHAT-005 |
| 설명 | 완료된 프로젝트의 채팅 기록 열람 |
| 권한 | super_admin만 |
| 조건 | 프로젝트 status가 'completed'인 경우 |

---

## 7. 매장 관리

### 7.1 매장 등록
| 항목 | 내용 |
|------|------|
| 기능 ID | STORE-001 |
| 설명 | 계약 매장 등록 |
| 권한 | super_admin, project_manager |
| 입력 | 매장명, 주소, 담당자, 연락처, 계약 유형, 방문 주기 |

### 7.2 매장 목록 조회
| 항목 | 내용 |
|------|------|
| 기능 ID | STORE-002 |
| 설명 | 담당 매장 목록 조회 |
| 권한 | master (담당 매장만), 관리자 (전체) |

### 7.3 방문 기록 등록
| 항목 | 내용 |
|------|------|
| 기능 ID | STORE-003 |
| 설명 | 매장 방문 후 작업 기록 등록 |
| 권한 | master |
| 입력 | 매장 ID, 방문일, 비포/애프터 사진, 작업 내용 |
| 처리 | store_visits 테이블에 삽입 |

### 7.4 방문 일정 조회
| 항목 | 내용 |
|------|------|
| 기능 ID | STORE-004 |
| 설명 | 예정된 방문 일정 캘린더 조회 |
| 출력 | 주간/월간 방문 일정 목록 |

---

## 8. 마스터 관리 (관리자)

### 8.1 마스터 목록 조회
| 항목 | 내용 |
|------|------|
| 기능 ID | MASTER-001 |
| 설명 | 전체 마스터 목록 조회 |
| 권한 | super_admin |
| 필터 | 활성 상태, 기술, 이름 검색 |
| 정렬 | 이름, 프로젝트 수, 평점 |

### 8.2 마스터 상세 조회
| 항목 | 내용 |
|------|------|
| 기능 ID | MASTER-002 |
| 설명 | 마스터 상세 정보 및 이력 조회 |
| 출력 | 프로필, 기술, 참여 프로젝트 목록, 통계 |

### 8.3 마스터 추가
| 항목 | 내용 |
|------|------|
| 기능 ID | MASTER-003 |
| 설명 | 새로운 마스터 계정 생성 (관리자가 직접) |
| 권한 | super_admin |
| 처리 | 계정 생성 → 임시 비밀번호 발급 → 이메일 발송 |

### 8.4 마스터 상태 변경
| 항목 | 내용 |
|------|------|
| 기능 ID | MASTER-004 |
| 설명 | 마스터 활성/비활성 상태 변경 |
| 권한 | super_admin |
| 처리 | profiles.is_active 업데이트 |

### 8.5 마스터 삭제
| 항목 | 내용 |
|------|------|
| 기능 ID | MASTER-005 |
| 설명 | 마스터 계정 비활성화 (소프트 삭제) |
| 권한 | super_admin |
| 조건 | 진행 중인 프로젝트가 없어야 함 |

---

## 9. 클라이언트 기능

### 9.1 내 프로젝트 조회
| 항목 | 내용 |
|------|------|
| 기능 ID | CLIENT-001 |
| 설명 | 클라이언트가 신청한 프로젝트 조회 |
| 권한 | client |
| 출력 | 프로젝트 목록, 진행 상태, 진행률 |

### 9.2 비포/애프터 확인
| 항목 | 내용 |
|------|------|
| 기능 ID | CLIENT-002 |
| 설명 | 작업 전후 사진 비교 확인 |
| 권한 | client (본인 프로젝트만) |
| 출력 | 구역별 비포/애프터 사진 쌍 |

### 9.3 완료 확인
| 항목 | 내용 |
|------|------|
| 기능 ID | CLIENT-003 |
| 설명 | 클라이언트가 작업 완료 확인 |
| 권한 | client |
| 조건 | 프로젝트 상태가 'review'일 때 |
| 처리 | 프로젝트 상태를 'completed'로 변경 |

---

## 10. 포트폴리오

### 10.1 포트폴리오 조회
| 항목 | 내용 |
|------|------|
| 기능 ID | PORTFOLIO-001 |
| 설명 | 완료된 프로젝트 포트폴리오 조회 |
| 권한 | super_admin, project_manager |
| 필터 | 날짜 범위, 프로젝트 유형, 위치 |
| 출력 | 프로젝트 목록, 대표 비포/애프터 사진 |

### 10.2 포트폴리오 공유
| 항목 | 내용 |
|------|------|
| 기능 ID | PORTFOLIO-002 |
| 설명 | 포트폴리오 외부 공유 링크 생성 |
| 권한 | super_admin |
| 처리 | 공유용 토큰 생성 → 웹 링크 제공 |

---

## 11. 알림 기능

### 11.1 푸시 알림
| 상황 | 수신자 | 내용 |
|------|--------|------|
| 프로젝트 신청 | 관리자 | "홍길동님이 D마트 프로젝트에 신청했습니다" |
| 신청 승인 | 마스터 | "D마트 프로젝트 참가가 승인되었습니다" |
| 프로젝트 시작 | 참가자 | "D마트 프로젝트가 시작되었습니다" |
| 작업 완료 제출 | 관리자 | "홍길동님이 작업 완료를 제출했습니다" |
| 새 채팅 메시지 | 참가자 | "D마트 채팅방에 새 메시지가 있습니다" |
| 검토 요청 | 클라이언트 | "D마트 프로젝트 검토를 요청합니다" |

---

## 12. 개발 우선순위

### Phase 1 (MVP)
1. 인증 (회원가입, 로그인)
2. 프로필 관리
3. 프로젝트 CRUD (관리자)
4. 프로젝트 참가 (마스터)
5. 사진 업로드

### Phase 2
1. 실시간 채팅
2. 클라이언트 화면
3. 비포/애프터 비교

### Phase 3
1. 매장 관리
2. 포트폴리오
3. 푸시 알림
4. 통계/대시보드
